<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Imprimibles ‚Äì NicaHub</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<!-- ‚úÖ LazyLoad -->
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js"></script>

<style>
/* sensaci√≥n app m√≥vil */
.card-touch{
    transition: transform .15s ease;
}
.card-touch:active{
    transform: scale(.96);
}
</style>

</head>

<body class="bg-blue-50 min-h-screen">

<!-- HEADER -->
<header class="bg-blue-600 text-white py-4 text-center shadow-md sticky top-0 z-10">
    <h1 class="text-xl md:text-2xl font-bold flex justify-center items-center">
        <span class="material-icons mr-2">print</span>
        Imprimibles Educativos
    </h1>
</header>

<main class="max-w-6xl mx-auto px-3 md:px-4 mt-5">

    <!-- ===== FILTROS ===== -->
    <div class="flex overflow-x-auto gap-3 mb-6 pb-2">

        <button onclick="filtrar('all')" 
            class="btnFiltro bg-blue-600 text-white px-4 py-2 rounded-full whitespace-nowrap">
            Todos
        </button>

        <button onclick="filtrar('dotted_pics')" 
            class="btnFiltro bg-white shadow px-4 py-2 rounded-full whitespace-nowrap">
            ‚úèÔ∏è Dotted
        </button>

        <button onclick="filtrar('counting_pics')" 
            class="btnFiltro bg-white shadow px-4 py-2 rounded-full whitespace-nowrap">
            üß© Count
        </button>

        <button onclick="filtrar('mask_activity')" 
            class="btnFiltro bg-white shadow px-4 py-2 rounded-full whitespace-nowrap">
            üé≠ Crafts
        </button>

    </div>

    <!-- GALERIA -->
    <div id="galeria"
         class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
    </div>

</main>

<script>

let DATA = [];
let lazyLoadInstance;

async function cargarImprimibles(){

    const res = await fetch("data/imprimible.json");
    DATA = await res.json();

    render(DATA);
}

function render(lista){

    const galeria = document.getElementById("galeria");
    galeria.innerHTML = "";

    lista.forEach(item => {

        galeria.innerHTML += `
        <div class="bg-white rounded-2xl shadow-md p-3
                    flex flex-col justify-between text-center
                    card-touch">

            <div>
                <img
                    data-src="${item.img}"
                    class="lazy mx-auto mb-3 max-h-36 object-contain"
                    alt="${item.word}">

                <h3 class="font-semibold text-sm md:text-base">${item.word}</h3>
                <p class="text-xs text-gray-500 mb-3">
                    ${item.description}
                </p>
            </div>

            <button onclick="imprimir('${item.img}')"
                class="bg-blue-600 text-white py-2 rounded-xl text-sm
                       active:scale-95 transition">
                Imprimir
            </button>

        </div>`;
    });

    // ‚úÖ activar lazyload
    if(lazyLoadInstance){
        lazyLoadInstance.update();
    }else{
        lazyLoadInstance = new LazyLoad({
            elements_selector: ".lazy"
        });
    }
}

function filtrar(tipo){

    if(tipo === "all"){
        render(DATA);
        return;
    }

    const filtrado = DATA.filter(item => item.type === tipo);
    render(filtrado);
}

function imprimir(src){

    const ventana = window.open("");

    ventana.document.write(`
        <html>
        <body style="margin:0;display:flex;justify-content:center;align-items:center;height:100vh;">
            <img src="${src}" style="max-width:95%">
            <script>
                window.onload=function(){
                    window.print();
                    window.onafterprint=()=>window.close();
                }
            <\/script>
        </body>
        </html>
    `);

    ventana.document.close();
}

cargarImprimibles();

</script>

<br>
</body>
</html>